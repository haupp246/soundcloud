/* Tiny HTML5 Music player by Themistokle Benetatos */ function Track(e,t,i,n,d){function a(){if(!b.src){r("loading");var e=document.getElementById(p);b.src=e.value,k.width=document.getElementById(f).offsetWidth}}function o(e,t,i,n,d,a,o){var l=~~(a/60),r=~~(a%60);e.fillStyle="rgba(0,0,0,0.8)",e.fillRect(t,i,n,d);var c=8;e.font=c+"pt Arial",e.fillStyle=o,e.textAlign="right",e.fillText((10>l?"0"+l:l)+":"+(10>r?"0"+r:r),n-3,d-4)}function l(){var e=Math.round(b.currentTime);if(k.getContext){var t=k.getContext("2d");if(t.clearRect(0,0,k.clientWidth,k.clientHeight),b.buffered.length>0){t.fillStyle="rgba(245,215,110,0.25)";var i=b.buffered.length>0?b.buffered.length-1:0;t.fillRect(0,0,b.buffered.end(i)/b.duration*k.clientWidth,k.clientHeight)}t.fillStyle=b.paused?"rgba(230,126,34,0.3)":"rgba(230,126,34,0.6)";var n=e/b.duration*k.clientWidth;n>0&&t.fillRect(0,0,n,k.clientHeight),b.duration&&o(t,k.clientWidth-32,k.clientHeight-15,k.clientWidth,k.clientHeight,b.duration,"#BBBBBB"),b.currentTime&&o(t,0,k.clientHeight-15,32,k.clientHeight,b.currentTime,"#e67e22")}}function r(e){var t=document.getElementById(m);if(t.getContext){var i=t.getContext("2d");switch(i.clearRect(0,0,t.clientWidth,t.clientHeight),i.fillStyle="rgb(255,255,255)",e){case"loading":i.beginPath(),i.arc(t.clientWidth/2,t.clientHeight/2,6,0,2*Math.PI,!1),i.fill();break;case"pause":i.fillRect(0,0,t.clientWidth/2-2,t.clientHeight),i.fillRect(t.clientWidth/2+2,0,t.clientWidth,t.clientHeight);break;case"play":default:i.beginPath(),i.moveTo(0,0),i.lineTo(0,t.clientHeight),i.lineTo(t.clientHeight,t.clientHeight/2),i.fill()}}}function c(t){a(),t||(t=window.event);try{var i=b.duration*((void 0==t.offsetX?t.layerX:t.offsetX)/k.clientWidth);if(isNaN(i)&&(i=0),b.buffered.length>0){var d=b.buffered.length-1;if(i>b.buffered.end(d)){var o=b.buffered.end(d);o>=0&&o<b.duration&&(i=o)}b.currentTime=i}b.paused&&(null!=n.audio&&n.audio!=b&&n.audio.pause(),b.play(),n.audio=b,n.id=e)}catch(l){console.log("Error while using seek bar: "+l)}}function u(){try{a(),b.paused?(null!=n.audio&&n.audio!=b&&n.audio.pause(),b.play(),n.audio=b,n.id=e):b.pause()}catch(t){console.log("Error while playing mp3 file: "+t)}}function s(){var e=document.createElement("div");e.id=h,e.className="audioplayer",divContent='<audio id="'+g+"\">Your browser doesn't support HTML5 audio tag.</audio>",divContent+='<div class="audiocontrollers">',divContent+='<input id="'+p+'" type="hidden" value="'+t.url+'" />',divContent+='<div id="'+y+'" class="audiobtnplay">',divContent+='<div class="audiobtnplaybgrd">',divContent+='<canvas id="'+m+'" class="audiobtnimg" width="15" height="15"></canvas>',divContent+="</div>",divContent+="</div>",divContent+='<div class="audiodetails">',divContent+='<div class="audiotitle">'+t.title+"</div>",divContent+='<div class="audioyear">'+t.year+"</div>",divContent+="</div>",divContent+="</div>",divContent+='<div class="audiodisplay">',divContent+=1==d?'<img class="audiowaveform" src="'+t.url+'.png"/>':'<div class="noaudiowaveform"></div>',divContent+='<canvas id="'+C+'" class="audioSeek" width="'+document.getElementById(f).offsetWidth+'" height="50">'+w+"</canvas>",divContent+="</div>",e.innerHTML=divContent,document.getElementById(f).appendChild(e),r("play")}function v(){s(),b=document.getElementById(g),k=document.getElementById(C),document.getElementById(y).addEventListener("click",function(){u()},!1),b.addEventListener("playing",function(){r("pause"),l()},!1),b.addEventListener("pause",function(){r("play"),l()},!1),b.addEventListener("ended",function(){r("play"),this.pause(),this.currentTime=0,l(),i(e)},!1),b.addEventListener("timeupdate",function(){l()},!1),b.addEventListener("progress",function(){l()},!1),k.addEventListener("click",function(e){c(e)},!1),k.addEventListener("mousedown",function(){document.onmousemove=function(e){c(e)},document.onmouseup=function(){document.onmousemove=null}},!1),window.addEventListener("resize",function(){k.width=document.getElementById(f).offsetWidth},!1),b.addEventListener("error",function(e){console.log("Error while loading mp3 file: "+e)},!1)}var e=e,f="all_tracks",g="audioMP3_"+e.toString(),h="audio_"+e.toString(),p="audioFile_"+e.toString(),y="audioBTNPlay_"+e.toString(),m="audioBTNImg_"+e.toString(),C="audioSeek_"+e.toString(),b=null,k=null,w="Your browser doesn't support HTML5 canvas tag.";v(),this.callback=function(){4==b.readyState&&(b.currentTime=0),u()}}function tinyplayer(e,t,i){window.HTMLAudioElement&&window.addEventListener("DOMContentLoaded",function(){function n(e){var t=[{key:"Spacebar",description:"Toggle play / pause"},{key:"[",description:"Play previous track"},{key:"]",description:"Play next track"},{key:"p",description:"Rewind current track"}],i=document.createElement("div");i.id="audiohelp",divContent='<div id="audiohelptitle"><h3>List of available shorcuts:</h3></div>',divContent+='<div id="audiohelpcommands">';for(var n=0;n<t.length;n++)divContent+='<div class="audiohelpshortcuts">',divContent+='<div class="audiohelpkey">'+t[n].key+"</div>",divContent+='<div class="audiohelpdescription">'+t[n].description+"</div>",divContent+="</div>";divContent+="</div>",i.innerHTML=divContent,document.getElementById(e).appendChild(i)}function d(e){switch(e.keyCode){case 80:if(e.preventDefault(),null==l.audio)return;l.audio.currentTime=0,l.audio.play();break;case 219:e.preventDefault(),null==l.id&&(l.id=0),a(l.id);break;case 221:e.preventDefault(),null==l.id&&(l.id=0),o(l.id);break;case 32:if(e.preventDefault(),null==l.audio)return void o(-1);l.audio.paused?l.audio.play():l.audio.pause()}}function a(e){try{r[--e>=0?e:r.length].callback()}catch(t){console.log("Error while playing previous track: "+t)}}function o(e){try{r[++e<r.length?e:0].callback()}catch(t){console.log("Error while playing next track: "+t)}}void 0!=i&&n("all_tracks");var l={id:null,audio:null},r=new Array;window.addEventListener("keydown",d,!1);for(var c=0;c<e.length;c++)r[c]=new Track(c,e[c],o,l,t)},!1)}